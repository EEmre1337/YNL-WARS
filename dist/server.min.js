Object.defineProperty(exports,"__esModule",{value:!0}),exports.server=exports.io=exports.gameState=void 0;var _express=_interopRequireDefault(require("express")),_http=require("http"),_socket=require("socket.io"),_gameConfig=require("./src/modules/gameConfig.js"),_socketHandlers=require("./src/modules/socketHandlers.js"),_projectileSystem=require("./src/modules/projectileSystem.js"),_itemSystem=require("./src/modules/itemSystem.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _createForOfIteratorHelper(e,t){var a,r,o,n,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return o=!(r=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return r=e.done,e},e:function(e){o=!0,a=e},f:function(){try{r||null==s.return||s.return()}finally{if(o)throw a}}};if(Array.isArray(e)||(s=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var a;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(a="Object"===(a={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var app=(0,_express.default)(),server=exports.server=(0,_http.createServer)(app),io=exports.io=new _socket.Server(server),gameState=(app.use(_express.default.static("public")),exports.gameState={players:{},projectiles:[],walls:[],flag:{x:800,y:600,holder:null},score:{red:0,blue:0},redSpawn:{x:100,y:600},blueSpawn:{x:1500,y:600},medikits:[],armors:[],grenades:[],speedBoosters:[],lastGrenadeSpawn:0,lastSpeedBoosterSpawn:0});function findValidPosition(){for(var e=!1;!e;){var t,a=1600*Math.random(),r=1200*Math.random(),e=!0,o=_createForOfIteratorHelper(_gameConfig.walls);try{for(o.s();!(t=o.n()).done;){var n=t.value;if(a>=n.x-30&&a<=n.x+n.width+30&&r>=n.y-30&&r<=n.y+n.height+30){e=!1;break}}}catch(e){o.e(e)}finally{o.f()}var s=Math.sqrt(Math.pow(a-_gameConfig.redSpawn.x,2)+Math.pow(r-_gameConfig.redSpawn.y,2)),i=Math.sqrt(Math.pow(a-_gameConfig.blueSpawn.x,2)+Math.pow(r-_gameConfig.blueSpawn.y,2));(s<100||i<100)&&(e=!1),(a<30||1570<a||r<30||1170<r)&&(e=!1)}return{x:a,y:r}}function spawnGrenade(){var e=findValidPosition(),e={x:e.x,y:e.y,active:!0};gameState.grenades=gameState.grenades.filter(function(e){return e.active}),gameState.grenades.push(e),io.emit("updateGrenades",gameState.grenades)}function spawnSpeedBooster(){var e=findValidPosition(),e={x:e.x,y:e.y,active:!0};gameState.speedBoosters=gameState.speedBoosters.filter(function(e){return e.active}),gameState.speedBoosters.push(e),io.emit("updateSpeedBoosters",gameState.speedBoosters)}function createExplosion(a,r,o){Object.values(gameState.players).forEach(function(e){var t;e.id!==o&&(t=Math.sqrt(Math.pow(e.x-a,2)+Math.pow(e.y-r,2)))<=100&&(t=t<=100/3?3:t<=200/3?2:1,e.health=Math.max(0,e.health-t),e.health<=0)&&respawnPlayer(e)})}setInterval(function(){6e4<=Date.now()-gameState.lastGrenadeSpawn&&(spawnGrenade(),gameState.lastGrenadeSpawn=Date.now()),6e4<=Date.now()-gameState.lastSpeedBoosterSpawn&&(spawnSpeedBooster(),gameState.lastSpeedBoosterSpawn=Date.now()),Object.values(gameState.players).forEach(function(t){gameState.grenades.forEach(function(e){e.active&&Math.abs(t.x-e.x)<30&&Math.abs(t.y-e.y)<30&&(e.active=!1,t.hasGrenade=!0,io.emit("updateGrenades",gameState.grenades))}),gameState.speedBoosters.forEach(function(e){e.active&&Math.abs(t.x-e.x)<30&&Math.abs(t.y-e.y)<30&&(e.active=!1,t.speed=1.5*(t.speed||5),setTimeout(function(){gameState.players[t.id]&&(gameState.players[t.id].speed/=1.5)},2e4),io.to(t.id).emit("speedBoostActive",2e4),io.emit("updateSpeedBoosters",gameState.speedBoosters))})})},1e3/60),spawnGrenade(),spawnSpeedBooster(),(0,_socketHandlers.setupSocketHandlers)(io,gameState),(0,_projectileSystem.setupProjectileSystem)(io,gameState),(0,_itemSystem.setupItemSystem)(io,gameState),io.on("connection",function(n){n.on("throwGrenade",function(e){var t,a,r,o=gameState.players[n.id];o&&o.hasGrenade&&(t={x:o.x,y:o.y,dx:15*Math.cos(e.angle),dy:15*Math.sin(e.angle),throwerId:n.id},a=0,r=setInterval(function(){t.x+=t.dx,t.y+=t.dy,t.dy+=.5,gameState.walls.forEach(function(e){t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height&&(clearInterval(r),createExplosion(t.x,t.y,t.throwerId))}),30<=++a&&(clearInterval(r),createExplosion(t.x,t.y,t.throwerId))},50),o.hasGrenade=!1)})}),server.listen(_gameConfig.PORT,function(){console.log("✅ Server läuft auf http://localhost:".concat(_gameConfig.PORT))});
//# sourceMappingURL=server.min.js.map
